<!-- ì¹´ì¹´ì˜¤í†¡ ì±„ë„ ì±„íŒ… ìœ„ì ¯ -->
<div id="kakao-chat-widget" class="kakao-chat-widget">
    <!-- ì±„íŒ… ë²„íŠ¼ -->
    <div id="chat-button" class="chat-button">
        <div class="chat-icon">
            <i class="fas fa-comment"></i>
        </div>
        <span class="chat-text">ë¬¸ì˜í•˜ê¸°</span>
        <div class="chat-notification" id="chat-notification" style="display: none;">
            <span class="notification-count">1</span>
        </div>
    </div>

    <!-- ì±„íŒ… ì°½ (í† ê¸€ ê°€ëŠ¥) -->
    <div id="chat-window" class="chat-window d-none">
        <div class="chat-header">
            <div class="chat-header-info">
                <div class="chat-avatar">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="chat-title">
                    <h6 class="mb-0">êµìœ¡í”Œë«í¼ ê³ ê°ì§€ì›</h6>
                    <small class="text-muted">í‰ê·  ì‘ë‹µì‹œê°„: 5ë¶„</small>
                </div>
            </div>
            <button type="button" class="btn-close-chat" id="close-chat">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="chat-body">
            <div class="chat-messages" id="chat-messages">
                <!-- ì´ˆê¸° ì•ˆë‚´ ë©”ì‹œì§€ -->
                <div class="message bot-message">
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-bubble">
                            <p>ì•ˆë…•í•˜ì„¸ìš”! êµìœ¡í”Œë«í¼ ê³ ê°ì§€ì›íŒ€ì…ë‹ˆë‹¤. ğŸ“</p>
                            <p>ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë¬¸ì˜í•´ ì£¼ì„¸ìš”.</p>
                        </div>
                        <div class="message-time">
                            <small class="text-muted">ì§€ê¸ˆ</small>
                        </div>
                    </div>
                </div>

                <!-- ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ -->
                <div class="message bot-message">
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-bubble">
                            <p>ìì£¼ ë¬»ëŠ” ì§ˆë¬¸:</p>
                            <div class="quick-replies">
                                <button class="quick-reply-btn" data-message="ê²°ì œ ë¬¸ì˜">
                                    ğŸ’³ ê²°ì œ ë¬¸ì˜
                                </button>
                                <button class="quick-reply-btn" data-message="ê°•ì˜ ì‹œì²­ ë¬¸ì œ">
                                    ğŸ¥ ì‹œì²­ ë¬¸ì œ
                                </button>
                                <button class="quick-reply-btn" data-message="í™˜ë¶ˆ ìš”ì²­">
                                    ğŸ’° í™˜ë¶ˆ ìš”ì²­
                                </button>
                                <button class="quick-reply-btn" data-message="ê³„ì • ë¬¸ì˜">
                                    ğŸ‘¤ ê³„ì • ë¬¸ì˜
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ë©”ì‹œì§€ ì…ë ¥ -->
            <div class="chat-input">
                <div class="input-group">
                    <input type="text" class="form-control" id="chat-message-input" 
                           placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." maxlength="500">
                    <button class="btn btn-primary" type="button" id="send-message">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="chat-features">
                    <small class="text-muted">
                        <i class="fas fa-shield-alt me-1"></i>
                        ê°œì¸ì •ë³´ëŠ” ì•”í˜¸í™”ë˜ì–´ ì•ˆì „í•˜ê²Œ ë³´í˜¸ë©ë‹ˆë‹¤
                    </small>
                </div>
            </div>
        </div>

        <!-- ì—°ê²° ìƒíƒœ -->
        <div class="chat-status" id="chat-status">
            <div class="status-indicator online">
                <span class="status-dot"></span>
                <small>ìƒë‹´ì‚¬ ì—°ê²° ê°€ëŠ¥</small>
            </div>
        </div>
    </div>

    <!-- ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ì—°ê²° ì˜µì…˜ -->
    <div class="kakao-connect-option d-none" id="kakao-connect">
        <div class="connect-header">
            <h6>ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ìƒë‹´ë°›ê¸°</h6>
            <p class="text-muted small">ë” í¸ë¦¬í•œ ìƒë‹´ì„ ìœ„í•´ ì¹´ì¹´ì˜¤í†¡ ì±„ë„ë¡œ ì´ë™í•˜ì„¸ìš”</p>
        </div>
        <div class="connect-buttons">
            <button class="btn btn-warning btn-sm w-100 mb-2" id="connect-kakao">
                <i class="fas fa-comment me-2"></i>ì¹´ì¹´ì˜¤í†¡ ì±„ë„ ì—°ê²°
            </button>
            <button class="btn btn-outline-secondary btn-sm w-100" id="continue-web">
                ì›¹ì—ì„œ ê³„ì†í•˜ê¸°
            </button>
        </div>
    </div>
</div>

<!-- ì±„íŒ… ìœ„ì ¯ ìŠ¤íƒ€ì¼ -->
<style>
.kakao-chat-widget {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 9999;
    font-family: 'Noto Sans KR', sans-serif;
}

.chat-button {
    background: linear-gradient(135deg, #fee500 0%, #fdd835 100%);
    color: #3c1e1e;
    border: none;
    padding: 15px 20px;
    border-radius: 30px;
    cursor: pointer;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
    position: relative;
    min-width: 60px;
    justify-content: center;
}

.chat-button:hover {
    background: linear-gradient(135deg, #fdd835 0%, #fbc02d 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 25px rgba(0, 0, 0, 0.2);
}

.chat-icon {
    font-size: 18px;
    animation: pulse 2s infinite;
}

.chat-text {
    font-weight: 600;
    font-size: 14px;
    white-space: nowrap;
}

.chat-notification {
    position: absolute;
    top: -8px;
    right: -8px;
    background: #ff4757;
    color: white;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
    animation: bounce 1s infinite;
}

.chat-window {
    position: absolute;
    bottom: 80px;
    right: 0;
    width: 350px;
    height: 500px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    border: 1px solid #e9ecef;
}

.chat-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 15px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.chat-header-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.chat-avatar {
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
}

.btn-close-chat {
    background: none;
    border: none;
    color: white;
    font-size: 16px;
    cursor: pointer;
    padding: 5px;
    border-radius: 3px;
    transition: background 0.2s;
}

.btn-close-chat:hover {
    background: rgba(255, 255, 255, 0.1);
}

.chat-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.chat-messages {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.message {
    display: flex;
    gap: 10px;
    max-width: 85%;
}

.bot-message {
    align-self: flex-start;
}

.user-message {
    align-self: flex-end;
    flex-direction: row-reverse;
}

.message-avatar {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: #f8f9fa;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    color: #6c757d;
    flex-shrink: 0;
}

.user-message .message-avatar {
    background: #007bff;
    color: white;
}

.message-content {
    flex: 1;
}

.message-bubble {
    background: #f8f9fa;
    padding: 12px 15px;
    border-radius: 15px;
    margin-bottom: 5px;
}

.user-message .message-bubble {
    background: #007bff;
    color: white;
}

.message-bubble p {
    margin: 0;
    line-height: 1.4;
}

.message-time {
    text-align: right;
}

.user-message .message-time {
    text-align: left;
}

.quick-replies {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 10px;
}

.quick-reply-btn {
    background: white;
    border: 1px solid #dee2e6;
    padding: 8px 12px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 13px;
    text-align: left;
}

.quick-reply-btn:hover {
    background: #f8f9fa;
    border-color: #007bff;
    color: #007bff;
}

.chat-input {
    padding: 15px 20px;
    border-top: 1px solid #e9ecef;
    background: #f8f9fa;
}

.chat-input .form-control {
    border-radius: 20px;
    border: 1px solid #dee2e6;
    padding: 10px 15px;
}

.chat-input .btn {
    border-radius: 20px;
    padding: 10px 15px;
}

.chat-features {
    margin-top: 8px;
    text-align: center;
}

.chat-status {
    padding: 10px 20px;
    background: #f8f9fa;
    border-top: 1px solid #e9ecef;
}

.status-indicator {
    display: flex;
    align-items: center;
    gap: 8px;
}

.status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #28a745;
    animation: pulse 2s infinite;
}

.kakao-connect-option {
    position: absolute;
    bottom: 80px;
    right: 0;
    width: 280px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
    padding: 20px;
    border: 1px solid #e9ecef;
}

.connect-header h6 {
    color: #2c3e50;
    margin-bottom: 8px;
}

/* ë°˜ì‘í˜• ë””ìì¸ */
@media (max-width: 768px) {
    .kakao-chat-widget {
        bottom: 15px;
        right: 15px;
    }
    
    .chat-button {
        padding: 12px;
        border-radius: 50%;
        min-width: 50px;
    }
    
    .chat-text {
        display: none;
    }
    
    .chat-window {
        width: calc(100vw - 30px);
        height: 70vh;
        bottom: 70px;
        right: -15px;
    }
    
    .kakao-connect-option {
        width: calc(100vw - 30px);
        right: -15px;
    }
}

/* ì• ë‹ˆë©”ì´ì…˜ */
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
    }
    40% {
        transform: translateY(-10px);
    }
    60% {
        transform: translateY(-5px);
    }
}

/* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
.chat-messages::-webkit-scrollbar {
    width: 6px;
}

.chat-messages::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

.chat-messages::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 10px;
}

.chat-messages::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}
</style>

<!-- ì±„íŒ… ìœ„ì ¯ JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const chatButton = document.getElementById('chat-button');
    const chatWindow = document.getElementById('chat-window');
    const closeChatBtn = document.getElementById('close-chat');
    const messageInput = document.getElementById('chat-message-input');
    const sendBtn = document.getElementById('send-message');
    const messagesContainer = document.getElementById('chat-messages');
    const quickReplyBtns = document.querySelectorAll('.quick-reply-btn');
    const connectKakaoBtn = document.getElementById('connect-kakao');
    const continueWebBtn = document.getElementById('continue-web');
    
    let isOpen = false;
    let messageCount = 0;
    
    // ì±„íŒ… ì°½ í† ê¸€
    chatButton.addEventListener('click', function() {
        toggleChat();
    });
    
    closeChatBtn.addEventListener('click', function() {
        toggleChat();
    });
    
    function toggleChat() {
        isOpen = !isOpen;
        chatWindow.classList.toggle('d-none', !isOpen);
        
        if (isOpen) {
            messageInput.focus();
            // ì½ì§€ ì•Šì€ ë©”ì‹œì§€ ì•Œë¦¼ ì œê±°
            document.getElementById('chat-notification').style.display = 'none';
        }
    }
    
    // ë©”ì‹œì§€ ì „ì†¡
    sendBtn.addEventListener('click', sendMessage);
    messageInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });
    
    function sendMessage() {
        const message = messageInput.value.trim();
        if (!message) return;
        
        // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
        addMessage(message, 'user');
        messageInput.value = '';
        
        // ë´‡ ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜
        setTimeout(() => {
            addBotResponse(message);
        }, 1000);
    }
    
    // ë¹ ë¥¸ ë‹µë³€ ë²„íŠ¼
    quickReplyBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const message = this.dataset.message;
            messageInput.value = message;
            sendMessage();
        });
    });
    
    function addMessage(text, sender) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${sender}-message`;
        
        const currentTime = new Date().toLocaleTimeString('ko-KR', {
            hour: '2-digit',
            minute: '2-digit'
        });
        
        messageDiv.innerHTML = `
            <div class="message-avatar">
                ${sender === 'user' ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>'}
            </div>
            <div class="message-content">
                <div class="message-bubble">
                    <p>${text}</p>
                </div>
                <div class="message-time">
                    <small class="text-muted">${currentTime}</small>
                </div>
            </div>
        `;
        
        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
        
        messageCount++;
    }
    
    function addBotResponse(userMessage) {
        let response = '';
        
        // ê°„ë‹¨í•œ ë´‡ ì‘ë‹µ ë¡œì§
        if (userMessage.includes('ê²°ì œ') || userMessage.includes('ğŸ’³')) {
            response = 'ê²°ì œ ê´€ë ¨ ë¬¸ì˜í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ê²°ì œëŠ” í† ìŠ¤í˜ì´ë¥¼ í†µí•´ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ë˜ë©°, ì¹´ë“œ, ê³„ì¢Œì´ì²´, íœ´ëŒ€í° ê²°ì œê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ê²°ì œ ì¤‘ ë¬¸ì œê°€ ìˆìœ¼ì‹œë©´ êµ¬ì²´ì ì¸ ìƒí™©ì„ ì•Œë ¤ì£¼ì„¸ìš”.';
        } else if (userMessage.includes('ê°•ì˜') || userMessage.includes('ì‹œì²­') || userMessage.includes('ğŸ¥')) {
            response = 'ê°•ì˜ ì‹œì²­ ê´€ë ¨ ë¬¸ì˜ì…ë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•´ ì£¼ì‹œê³ , ë¸Œë¼ìš°ì €ë¥¼ ìµœì‹  ë²„ì „ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•´ ë³´ì„¸ìš”. ê³„ì† ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ì‚¬ìš©í•˜ì‹œëŠ” ê¸°ê¸°ì™€ ë¸Œë¼ìš°ì € ì •ë³´ë¥¼ ì•Œë ¤ì£¼ì‹œë©´ ë” ìì„¸íˆ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.';
        } else if (userMessage.includes('í™˜ë¶ˆ') || userMessage.includes('ğŸ’°')) {
            response = 'í™˜ë¶ˆ ìš”ì²­ì„ ì ‘ìˆ˜í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤. êµ¬ë§¤ í›„ 7ì¼ ì´ë‚´, ì½˜í…ì¸  ì´ìš©ë¥  10% ë¯¸ë§Œì¸ ê²½ìš° í™˜ë¶ˆì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì£¼ë¬¸ë²ˆí˜¸ì™€ í™˜ë¶ˆ ì‚¬ìœ ë¥¼ ì•Œë ¤ì£¼ì‹œë©´ ë¹ ë¥´ê²Œ ì²˜ë¦¬í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.';
        } else if (userMessage.includes('ê³„ì •') || userMessage.includes('ë¡œê·¸ì¸') || userMessage.includes('ğŸ‘¤')) {
            response = 'ê³„ì • ê´€ë ¨ ë¬¸ì˜ì…ë‹ˆë‹¤. ë¡œê·¸ì¸ì— ë¬¸ì œê°€ ìˆìœ¼ì‹œë©´ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •ì„ ì‹œë„í•´ ë³´ì‹œê³ , ê°€ì…í•˜ì‹  ì´ë©”ì¼ ì£¼ì†Œë¡œ ì¬ì„¤ì • ë§í¬ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”. ê³„ì • ë³µêµ¬ê°€ í•„ìš”í•˜ì‹œë©´ ê°€ì… ì‹œ ì‚¬ìš©í•œ ì´ë©”ì¼ì„ ì•Œë ¤ì£¼ì„¸ìš”.';
        } else if (userMessage.includes('ì•ˆë…•') || userMessage.includes('hello')) {
            response = 'ì•ˆë…•í•˜ì„¸ìš”! êµìœ¡í”Œë«í¼ ê³ ê°ì§€ì›íŒ€ì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”? ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë§ì”€í•´ ì£¼ì„¸ìš”. ğŸ˜Š';
        } else {
            response = 'ë¬¸ì˜í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ë” ì •í™•í•œ ë‹µë³€ì„ ìœ„í•´ ìƒë‹´ì‚¬ì™€ ì—°ê²°í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.';
            
            // ì¹´ì¹´ì˜¤í†¡ ì—°ê²° ì˜µì…˜ í‘œì‹œ
            setTimeout(() => {
                showKakaoConnectOption();
            }, 2000);
        }
        
        addMessage(response, 'bot');
    }
    
    function showKakaoConnectOption() {
        const kakaoConnect = document.getElementById('kakao-connect');
        kakaoConnect.classList.remove('d-none');
        
        setTimeout(() => {
            kakaoConnect.classList.add('d-none');
        }, 10000); // 10ì´ˆ í›„ ìë™ ìˆ¨ê¹€
    }
    
    // ì¹´ì¹´ì˜¤í†¡ ì—°ê²°
    connectKakaoBtn?.addEventListener('click', function() {
        // ì‹¤ì œ ì¹´ì¹´ì˜¤í†¡ ì±„ë„ë¡œ ì—°ê²°í•˜ëŠ” ë¡œì§
        // window.open('https://pf.kakao.com/_your_channel_id/chat', '_blank');
        alert('ì¹´ì¹´ì˜¤í†¡ ì±„ë„ë¡œ ì—°ê²°ë©ë‹ˆë‹¤. ì¹´ì¹´ì˜¤í†¡ ì•±ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.');
        document.getElementById('kakao-connect').classList.add('d-none');
    });
    
    continueWebBtn?.addEventListener('click', function() {
        document.getElementById('kakao-connect').classList.add('d-none');
        addMessage('ì›¹ì—ì„œ ê³„ì† ìƒë‹´ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤. êµ¬ì²´ì ì¸ ë¬¸ì˜ì‚¬í•­ì„ ë§ì”€í•´ ì£¼ì„¸ìš”.', 'bot');
    });
    
    // ìƒˆ ë©”ì‹œì§€ ì•Œë¦¼ (ì‹œë®¬ë ˆì´ì…˜)
    function showNotification() {
        if (!isOpen) {
            document.getElementById('chat-notification').style.display = 'flex';
        }
    }
    
    // í˜ì´ì§€ ë¡œë“œ í›„ í™˜ì˜ ë©”ì‹œì§€ ì•Œë¦¼
    setTimeout(() => {
        if (!isOpen) {
            showNotification();
        }
    }, 5000);
});
</script>
